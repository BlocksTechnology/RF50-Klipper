[gcode_macro PRINT_END]
gcode:
    SET_GCODE_VARIABLE MACRO=_USER_VARIABLES VARIABLE=b_temp VALUE=0
    SET_GCODE_VARIABLE MACRO=_USER_VARIABLES VARIABLE=e_temp VALUE=0
    SET_GCODE_VARIABLE MACRO=_USER_VARIABLES VARIABLE=auxiliary_fan_used VALUE=-1

    PRINT_END_PARK

    BED_MESH_CLEAR

    DISABLE_FILAMENT_SENSORS 
    
    SET_HEATER_TEMPERATURE HEATER=extruder TARGET=0
    SET_FAN_SPEED FAN=Part_Cooling_Fan SPEED=0
    SET_FAN_SPEED FAN=Auxiliary_Cooling_Fan SPEED=0
    SET_FAN_SPEED FAN=Chamber_Exhaust_Fan SPEED=0

    M117 Print complete
    RESPOND MSG="Print complete"

    {% if printer.print_stats.state == "cancelled" %}
        M117 Print Cancelled 
        {action_respond_info("Print Cancelled")}

        SDCARD_RESET_FILE
        BASE_CANCEL_PRINT
    {% endif %}